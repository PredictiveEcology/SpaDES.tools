<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast `adjacent` function, and Just In Time compiled version — adj.raw • SpaDES.tools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Fast `adjacent` function, and Just In Time compiled version — adj.raw" />

<meta property="og:description" content="Faster function for determining the cells of the 4, 8 or bishop
 neighbours of the cells. This is a hybrid function that uses
 matrix for small numbers of loci (&amp;lt;1e4) and data.table for larger numbers of loci" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.tools</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/SpaDES.tools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast `adjacent` function, and Just In Time compiled version</h1>
    <small class="dont-index">Source: <a href='https://github.com/PredictiveEcology/SpaDES.tools/blob/master/R/neighbourhood.R'><code>R/neighbourhood.R</code></a></small>
    <div class="hidden name"><code>adj.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Faster function for determining the cells of the 4, 8 or bishop
 neighbours of the <code>cells</code>. This is a hybrid function that uses
 matrix for small numbers of loci (&lt;1e4) and data.table for larger numbers of loci</p>
    
    </div>

    <pre class="usage"><span class='fu'>adj.raw</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>cells</span>, <span class='kw'>directions</span> <span class='kw'>=</span> <span class='fl'>8</span>, <span class='kw'>sort</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>pairs</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>include</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>target</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>numCol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>numCell</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>match.adjacent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>cutoff.for.data.table</span> <span class='kw'>=</span> <span class='fl'>2000</span>, <span class='kw'>torus</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>numNeighs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>returnDT</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>adj</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>cells</span>, <span class='kw'>directions</span> <span class='kw'>=</span> <span class='fl'>8</span>, <span class='kw'>sort</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>pairs</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>include</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>target</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>numCol</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>numCell</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>match.adjacent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>cutoff.for.data.table</span> <span class='kw'>=</span> <span class='fl'>2000</span>, <span class='kw'>torus</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>numNeighs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>returnDT</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p><code>Raster*</code> object for which adjacency will be calculated.</p></td>
    </tr>
    <tr>
      <th>cells</th>
      <td><p>vector of cell numbers for which adjacent cells should be found.
Cell numbers start with 1 in the upper-left corner and increase
from left to right and from top to bottom.</p></td>
    </tr>
    <tr>
      <th>directions</th>
      <td><p>the number of directions in which cells should be connected:
4 (rook's case), 8 (queen's case), or <code>"bishop"</code> to connect
cells with one-cell diagonal moves.
Or a neighbourhood matrix (see Details).</p></td>
    </tr>
    <tr>
      <th>sort</th>
      <td><p>logical. Whether the outputs should be sorted or not, using cell ids
of the <code>from</code> cells (and <code>to</code> cells, if <code>match.adjacent</code>
is <code>TRUE</code>).</p></td>
    </tr>
    <tr>
      <th>pairs</th>
      <td><p>logical. If <code>TRUE</code>, a matrix of pairs of adjacent cells is returned.
If <code>FALSE</code>, a vector of cells adjacent to cells is returned</p></td>
    </tr>
    <tr>
      <th>include</th>
      <td><p>logical. Should the focal cells be included in the result?</p></td>
    </tr>
    <tr>
      <th>target</th>
      <td><p>a vector of cells that can be spread to. This is the inverse of a mask.</p></td>
    </tr>
    <tr>
      <th>numCol</th>
      <td><p>numeric indicating number of columns in the raster.
Using this with <code>numCell</code> is a bit faster execution time.</p></td>
    </tr>
    <tr>
      <th>numCell</th>
      <td><p>numeric indicating number of cells in the raster.
Using this with <code>numCol</code> is a bit faster execution time.</p></td>
    </tr>
    <tr>
      <th>match.adjacent</th>
      <td><p>logical. Should the returned object be the same as
<code><a href='http://www.rdocumentation.org/packages/raster/topics/adjacent'>raster::adjacent</a></code>.
Default <code>FALSE</code>, which is faster.</p></td>
    </tr>
    <tr>
      <th>cutoff.for.data.table</th>
      <td><p>numeric. If the number of cells is above this value,
the function uses data.table which is faster with
large numbers of cells. Default is 5000, which appears
to be the turning point where data.table becomes faster.</p></td>
    </tr>
    <tr>
      <th>torus</th>
      <td><p>Logical. Should the spread event wrap around to the other side of the raster?
Default is <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>numeric If not <code>NULL</code> (default), then function will return <code>"id"</code> column.</p></td>
    </tr>
    <tr>
      <th>numNeighs</th>
      <td><p>A numeric scalar, indicating how many neighbours to return. Must be
less than or equal to <code>directions</code>; which neighbours are random
with equal probabilities.</p></td>
    </tr>
    <tr>
      <th>returnDT</th>
      <td><p>A logical. If TRUE, then the function will return the result
as a <code>data.table</code>, if the internals used <code>data.table</code>,
i.e., if number of cells is greater than <code>cutoff.for.data.table</code>.
User should be warned that this will therefore cause the output
format to change depending <code>cutoff.for.data.table</code>.
This will be faster for situations where <code>cutoff.for.data.table = TRUE</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Either a matrix (if more than 1 column, i.e., <code>pairs = TRUE</code>,
and/or <code>id</code> is provided), a vector (if only one column), or a <code>data.table</code>
(if <code>cutoff.for.data.table</code> is less than <code>length(cells)</code> <em>and</em>
<code>returnDT</code> is <code>TRUE</code>.
To get a consistent output, say a matrix, it would be wise to test the output
for its class.
The variable output is done to minimize coercion to maintain speed.
The columns will be one or more of <code>id</code>, <code>from</code>, <code>to</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Between 4x (large number loci) to 200x (small number loci) speed gains over
<code>adjacent</code> in raster package. There is some extra speed gain if
<code>NumCol</code> and <code>NumCells</code> are passed rather than a raster.
Efficiency gains come from:
 1. use <code>data.table</code> internally
    - no need to remove NAs because wrapped or outside points are
      just removed directly with data.table
    - use data.table to sort and fast select (though not fastest possible)
 2. don't make intermediate objects; just put calculation into return statement</p>
<p>The steps used in the algorithm are:
1. Calculate indices of neighbouring cells
2. Remove "to" cells that are
   - &lt;1 or &gt;numCells (i.e., they are above or below raster), using a single modulo
     calculation
   - where the modulo of "to" cells is equal to 1 if "from" cells are 0 (wrapped right
     to left)
   - or where the modulo of the "to" cells is equal to 0 if "from" cells are 1 (wrapped
     left to right)</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='http://www.rdocumentation.org/packages/raster/topics/adjacent'>adjacent</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>raster</span>)</div><div class='output co'>#&gt; <span class='message'>Loading required package: sp</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘raster’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:SpaDES.tools’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    resample</span></div><div class='input'><span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/raster'>raster</a></span>(<span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/extent'>extent</a></span>(<span class='fl'>0</span>, <span class='fl'>1000</span>, <span class='fl'>0</span>, <span class='fl'>1000</span>), <span class='kw'>res</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='no'>sam</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='fl'>1</span>:<span class='fu'>length</span>(<span class='no'>a</span>), <span class='fl'>1e4</span>)
<span class='no'>numCol</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/ncell'>ncol</a></span>(<span class='no'>a</span>)
<span class='no'>numCell</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/raster/topics/ncell'>ncell</a></span>(<span class='no'>a</span>)
<span class='no'>adj.new</span> <span class='kw'>&lt;-</span> <span class='fu'>adj</span>(<span class='kw'>numCol</span> <span class='kw'>=</span> <span class='no'>numCol</span>, <span class='kw'>numCell</span> <span class='kw'>=</span> <span class='no'>numCell</span>, <span class='kw'>cells</span> <span class='kw'>=</span> <span class='no'>sam</span>, <span class='kw'>directions</span> <span class='kw'>=</span> <span class='fl'>8</span>)
<span class='no'>adj.new</span> <span class='kw'>&lt;-</span> <span class='fu'>adj</span>(<span class='kw'>numCol</span> <span class='kw'>=</span> <span class='no'>numCol</span>, <span class='kw'>numCell</span> <span class='kw'>=</span> <span class='no'>numCell</span>, <span class='kw'>cells</span> <span class='kw'>=</span> <span class='no'>sam</span>, <span class='kw'>directions</span> <span class='kw'>=</span> <span class='fl'>8</span>,
               <span class='kw'>include</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Eliot McIntire

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

