<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Split and re-merge RasterLayer(s) — mergeRaster • SpaDES.tools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Split and re-merge RasterLayer(s) — mergeRaster" />
<meta property="og:description" content="splitRaster divides up a raster into an arbitrary number of pieces (tiles).
Split rasters can be recombined using do.call(merge, y) or mergeRaster(y),
where y &amp;lt;- splitRaster(x)." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.tools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/SpaDES.tools">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Split and re-merge RasterLayer(s)</h1>
    <small class="dont-index">Source: <a href='https://github.com/PredictiveEcology/SpaDES.tools/blob/master/R/mergeRaster.R'><code>R/mergeRaster.R</code></a>, <a href='https://github.com/PredictiveEcology/SpaDES.tools/blob/master/R/splitRaster.R'><code>R/splitRaster.R</code></a></small>
    <div class="hidden name"><code>splitRaster.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>splitRaster</code> divides up a raster into an arbitrary number of pieces (tiles).
Split rasters can be recombined using <code><a href='https://rdrr.io/r/base/do.call.html'>do.call(merge, y)</a></code> or <code>mergeRaster(y)</code>,
where <code>y &lt;- splitRaster(x)</code>.</p>
    </div>

    <pre class="usage"><span class='fu'>mergeRaster</span>(<span class='no'>x</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='co'># S4 method for list</span>
<span class='fu'>mergeRaster</span>(<span class='no'>x</span>, <span class='kw'>fun</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>splitRaster</span>(
  <span class='no'>r</span>,
  <span class='kw'>nx</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>ny</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>buffer</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>0</span>),
  <span class='kw'>path</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='no'>cl</span>,
  <span class='kw'>rType</span> <span class='kw'>=</span> <span class='st'>"FLT4S"</span>
)

<span class='co'># S4 method for RasterLayer</span>
<span class='fu'>splitRaster</span>(
  <span class='no'>r</span>,
  <span class='kw'>nx</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>ny</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>buffer</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>0</span>),
  <span class='kw'>path</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='no'>cl</span>,
  <span class='kw'>rType</span> <span class='kw'>=</span> <span class='st'>"FLT4S"</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A list of split raster tiles (i.e., from <code>splitRaster</code>).</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>Function (e.g. <code>mean</code>, <code>min</code>, or <code>max</code> that
accepts a <code>na.rm</code> argument. The default is <code>mean</code>.</p></td>
    </tr>
    <tr>
      <th>r</th>
      <td><p>The raster to be split.</p></td>
    </tr>
    <tr>
      <th>nx</th>
      <td><p>The number of tiles to make along the x-axis.</p></td>
    </tr>
    <tr>
      <th>ny</th>
      <td><p>The number of tiles to make along the y-axis.</p></td>
    </tr>
    <tr>
      <th>buffer</th>
      <td><p>Numeric vector of length 2 giving the size of the buffer along the x and y axes.
If these values less than or equal to <code>1</code> are used, this
is interpreted as the number of pixels (cells) to use as a buffer.
Values between <code>0</code> and <code>1</code> are interpreted as proportions
of the number of pixels in each tile (rounded up to an integer value).
Default is <code><a href='https://rdrr.io/r/base/c.html'>c(0, 0)</a></code>, which means no buffer.</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>Character specifying the directory to which the split tiles will be saved.
If missing, the function will write to memory.</p></td>
    </tr>
    <tr>
      <th>cl</th>
      <td><p>A cluster object. Optional. This would generally be created using
parallel::makeCluster or equivalent. This is an alternative way, instead
of <code>beginCluster()</code>, to use parallelism for this function, allowing for
more control over cluster use.</p></td>
    </tr>
    <tr>
      <th>rType</th>
      <td><p>Datatype of the split rasters. Defaults to FLT4S.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>mergeRaster</code> returns a <code>RasterLayer</code> object.</p>
<p><code>splitRaster</code> returns a list (length <code>nx*ny</code>) of cropped raster tiles.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>mergeRaster</code> differs from <code>merge</code> in how overlapping tile
regions are handled: <code>merge</code> retains the values of the first raster in
the list. This has the consequence of retaining the values from the buffered
region in the first tile in place of the values from the neighbouring tile.
On the other hand, <code>mergeRaster</code> retains the values of the tile region,
over the values in any buffered regions. This is useful for reducing edge
effects when performing raster operations involving contagious processes.
To use the average of cell values, or do another computation, use
<code><a href='https://rdrr.io/pkg/raster/man/mosaic.html'>mosaic</a></code>.
<code>mergeRaster</code> is also faster than <code>merge</code>. <code>mergeRaster</code> also
differs from <code><a href='https://rdrr.io/pkg/raster/man/mosaic.html'>mosaic</a></code> in speed and ability to take a
raster list. It can, however, use the average of cell values, or do other
computations. At last, <code>mergeRaster</code> can also merge tiles of a split
raster that were resampled and, therefore, could have had different changes
in the buffer sizes on each side of the raster. If the user resamples the
tiles and the new resolution is not a multiple of the original one,
<code>mergeRaster</code> will use mosaic with the max function to merge the tiles
with a message. The user can also pass the function to be used when mosaic
is triggered.</p>
<p>This function is parallel-aware, using the same mechanism as used in the <code>raster</code>
package. Specifically, if you start a cluster using <code><a href='https://rdrr.io/pkg/raster/man/cluster.html'>beginCluster</a></code>, then
this function will automatically use that cluster. It is always a good
idea to stop the cluster when finished, using <code><a href='https://rdrr.io/pkg/raster/man/cluster.html'>endCluster</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/raster/man/merge.html'>merge</a></code>, <code><a href='https://rdrr.io/pkg/raster/man/mosaic.html'>mosaic</a></code></p>
<p><code><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></code>, <code><a href='https://rdrr.io/pkg/raster/man/merge.html'>merge</a></code>.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>raster</span>)

<span class='co'># an example with dimensions:</span>
<span class='co'># nrow: 77</span>
<span class='co'># ncol: 101</span>
<span class='co'># nlayers: 3</span>
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/brick.html'>brick</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"external/rlogo.grd"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"raster"</span>))
<span class='no'>r</span> <span class='kw'>&lt;-</span> <span class='no'>b</span><span class='kw'>[[</span><span class='fl'>1</span>]] <span class='co'># use first layer only</span>
<span class='no'>nx</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='no'>ny</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span>

<span class='no'>tmpdir</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span>(), <span class='st'>"splitRaster-example"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/files2.html'>dir.create</a></span>(<span class='no'>tmpdir</span>)

<span class='no'>y0</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>tmpdir</span>, <span class='st'>"y0"</span>)) <span class='co'># no buffer</span>

<span class='co'># buffer: 10 pixels along both axes</span>
<span class='no'>y1</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>10</span>, <span class='fl'>10</span>), <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>tmpdir</span>, <span class='st'>"y1"</span>))

<span class='co'># buffer: half the width and length of each tile</span>
<span class='no'>y2</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.5</span>, <span class='fl'>0.5</span>), <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>tmpdir</span>, <span class='st'>"y2"</span>))

<span class='co'># parallel cropping</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()) {
  <span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>pmin</a></span>(<span class='kw pkg'>parallel</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span>(), <span class='fl'>4</span>) <span class='co'># use up to 4 cores</span>
  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/cluster.html'>beginCluster</a></span>(<span class='no'>n</span>)
  <span class='no'>y3</span> <span class='kw'>&lt;-</span> <span class='fu'>splitRaster</span>(<span class='no'>r</span>, <span class='no'>nx</span>, <span class='no'>ny</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.7</span>, <span class='fl'>0.7</span>), <span class='kw'>path</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span>(<span class='no'>tmpdir</span>, <span class='st'>"y3"</span>))
  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/cluster.html'>endCluster</a></span>()
}

<span class='co'># the original raster:</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()) <span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span>(<span class='no'>r</span>) <span class='co'># may require a call to `dev()` if using RStudio</span>

<span class='co'># the split raster:</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/layout.html'>layout</a></span>(<span class='kw'>mat</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span>(<span class='no'>nx</span> * <span class='no'>ny</span>), <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='no'>nx</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='no'>ny</span>))
<span class='no'>plotOrder</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>, <span class='fl'>8</span>, <span class='fl'>12</span>, <span class='fl'>3</span>, <span class='fl'>7</span>, <span class='fl'>11</span>, <span class='fl'>2</span>, <span class='fl'>6</span>, <span class='fl'>10</span>, <span class='fl'>1</span>, <span class='fl'>5</span>, <span class='fl'>9</span>)
<span class='kw'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>()) <span class='fu'><a href='https://rdrr.io/r/base/invisible.html'>invisible</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>y0</span>[<span class='no'>plotOrder</span>], <span class='no'>plot</span>))

<span class='co'># can be recombined using `raster::merge`</span>
<span class='no'>m0</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span>(<span class='no'>merge</span>, <span class='no'>y0</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='no'>m0</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span>(<span class='no'>merge</span>, <span class='no'>y1</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='no'>m1</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>m2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/do.call.html'>do.call</a></span>(<span class='no'>merge</span>, <span class='no'>y2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='no'>m2</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># or recombine using mergeRaster</span>
<span class='no'>n0</span> <span class='kw'>&lt;-</span> <span class='fu'>mergeRaster</span>(<span class='no'>y0</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='no'>n0</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>n1</span> <span class='kw'>&lt;-</span> <span class='fu'>mergeRaster</span>(<span class='no'>y1</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='no'>n1</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='no'>n2</span> <span class='kw'>&lt;-</span> <span class='fu'>mergeRaster</span>(<span class='no'>y2</span>)
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span>(<span class='no'>n2</span>, <span class='no'>r</span>) <span class='co'>## TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/unlink.html'>unlink</a></span>(<span class='no'>tmpdir</span>, <span class='kw'>recursive</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Yong Luo, Alex Chubaty, Tati Micheletti &amp; Ian Eddy</p>
<p>Alex Chubaty and Yong Luo</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


