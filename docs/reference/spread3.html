<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>An alternative spread function, conceived for insects — spread3 • SpaDES.tools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="An alternative spread function, conceived for insects — spread3" />
<meta property="og:description" content="This is built with spread2 and is still experimental.
This one differs from other attempts in that it treats the advection and
dispersal as mathematical vectors that are added together.
They are &quot;rounded&quot; to pixel centres." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.tools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/SpaDES.tools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>An alternative spread function, conceived for insects</h1>
    <small class="dont-index">Source: <a href='https://github.com/PredictiveEcology/SpaDES.tools/blob/master/R/spread3.R'><code>R/spread3.R</code></a></small>
    <div class="hidden name"><code>spread3.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is built with <code><a href='spread2.html'>spread2</a></code> and is still experimental.
This one differs from other attempts in that it treats the advection and
dispersal as mathematical vectors that are added together.
They are "rounded" to pixel centres.</p>
    </div>

    <pre class="usage"><span class='fu'>spread3</span><span class='op'>(</span>
  <span class='va'>start</span>,
  <span class='va'>rasQuality</span>,
  <span class='va'>rasAbundance</span>,
  <span class='va'>advectionDir</span>,
  <span class='va'>advectionMag</span>,
  <span class='va'>meanDist</span>,
  dispersalKernel <span class='op'>=</span> <span class='st'>"exponential"</span>,
  sdDist <span class='op'>=</span> <span class='fl'>1</span>,
  plot.it <span class='op'>=</span> <span class='fl'>2</span>,
  minNumAgents <span class='op'>=</span> <span class='fl'>50</span>,
  verbose <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"LandR.verbose"</span>, <span class='fl'>0</span><span class='op'>)</span>,
  saveStack <span class='op'>=</span> <span class='cn'>NULL</span>,
  skipChecks <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>start</th>
      <td><p>Raster indices from which to initiate dispersal</p></td>
    </tr>
    <tr>
      <th>rasQuality</th>
      <td><p>A raster with habitat quality. Currently, must
be scaled from 0 to 1, i.e., a probability of "settling"</p></td>
    </tr>
    <tr>
      <th>rasAbundance</th>
      <td><p>A raster where each pixel represents the number
of "agents" or pseudo-agents contained. This number of agents, will
be spread horizontally, and distributed from each pixel
that contains a non-zero non NA value.</p></td>
    </tr>
    <tr>
      <th>advectionDir</th>
      <td><p>A single number or <code>RasterLayer</code> in degrees from North = 0
(though it will use radians if all values are <code>abs(advectionDir) &gt; 2 * pi)</code>.
This indicates the direction of advective forcing (i.e., wind).</p></td>
    </tr>
    <tr>
      <th>advectionMag</th>
      <td><p>A single number or <code>RasterLayer</code> in distance units of the
<code>rasQuality</code>, e.g., meters, indicating the relative forcing that will
occur. It is imposed on the total event, i.e., if the <code>meanDist</code> is
<code>10000</code>, and <code>advectionMag</code> is <code>5000</code>, then the expected
distance (i.e., 63% of agents) will have settled by <code>15000</code> map units.</p></td>
    </tr>
    <tr>
      <th>meanDist</th>
      <td><p>A single number indicating the mean distance parameter in map units
(not pixels), for a negative exponential distribution
dispersal kernel (e.g., <code>dexp</code>). This will mean that 63<!-- % of agents will have -->
settled at this <code>meanDist</code> (still experimental)</p></td>
    </tr>
    <tr>
      <th>dispersalKernel</th>
      <td><p>Currently character string, with either `exponential` or `weibull`.
If</p></td>
    </tr>
    <tr>
      <th>sdDist</th>
      <td><p>A single number indicating the `sd` parameter of a 2 parameter `dispersalKernel`.
Defaults to `1`, which is the same as the `exponential` distribution.</p></td>
    </tr>
    <tr>
      <th>plot.it</th>
      <td><p>Numeric. With increasing numbers above 0, there will be plots
produced during iterations. Currently, only 0, 1, or 2+ are distinct.</p></td>
    </tr>
    <tr>
      <th>minNumAgents</th>
      <td><p>Single numeric indicating the minimum number of agents
to consider all dispersing finished. Default is 50</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Numeric. With increasing numbers above 0, there will be more
messages produced. Currently, only 0, 1, or 2+ are distinct.</p></td>
    </tr>
    <tr>
      <th>saveStack</th>
      <td><p>If provided as a character string, it will save each iteration
as part of a <code>rasterStack</code> to disk upon exit.</p></td>
    </tr>
    <tr>
      <th>skipChecks</th>
      <td><p>Logical. If `TRUE`, assertions will be skipped (faster, but could miss
problems)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>data.table</code> with all information used during the spreading</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## these tests are fairly heavy, so don't run during automated tests</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'>#########################################################</span>
  <span class='co'># Simple case, no variation in rasQuality, numeric advectionDir and advectionMag</span>
  <span class='co'>#########################################################</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/raster'>raster</a></span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://quickplot.predictiveecology.org'>quickPlot</a></span><span class='op'>)</span>
  <span class='va'>maxDim</span> <span class='op'>&lt;-</span> <span class='fl'>10000</span>
  <span class='va'>ras</span> <span class='op'>&lt;-</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extent.html'>extent</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>maxDim</span>, <span class='fl'>0</span>, <span class='va'>maxDim</span><span class='op'>)</span><span class='op'>)</span>, res <span class='op'>=</span> <span class='fl'>100</span>, vals <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
  <span class='va'>rasQuality</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>ras</span><span class='op'>)</span>
  <span class='va'>rasQuality</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
  <span class='va'>rasAbundance</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span>
  <span class='va'>rasAbundance</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
  <span class='co'># startPixel &lt;- middlePixel(rasAbundance)</span>
  <span class='va'>startPixel</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>rasAbundance</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>30</span><span class='op'>)</span>
  <span class='va'>rasAbundance</span><span class='op'>[</span><span class='va'>startPixel</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
  <span class='va'>advectionDir</span> <span class='op'>&lt;-</span> <span class='fl'>70</span>
  <span class='va'>advectionMag</span> <span class='op'>&lt;-</span> <span class='fl'>4</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/resolution.html'>res</a></span><span class='op'>(</span><span class='va'>rasAbundance</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
  <span class='va'>meanDist</span> <span class='op'>&lt;-</span> <span class='fl'>2600</span>

   <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
     <span class='co'># Test the dispersal kernel -- create a function</span>
     <span class='va'>plotDispersalKernel</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>out</span>, <span class='va'>meanAdvectionMag</span><span class='op'>)</span> <span class='op'>{</span>
       <span class='va'>out</span><span class='op'>[</span>, <span class='va'>disGroup</span> <span class='op'>:=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>round</a></span><span class='op'>(</span><span class='va'>distance</span> <span class='op'>/</span> <span class='fl'>100</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>100</span><span class='op'>]</span>
       <span class='va'>freqs</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>[</span>, <span class='va'>.N</span>, by <span class='op'>=</span> <span class='st'>"disGroup"</span><span class='op'>]</span>
       <span class='va'>freqs</span><span class='op'>[</span>, <span class='fu'>`:=`</span><span class='op'>(</span>cumSum <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>N</span><span class='op'>)</span>, N <span class='op'>=</span> <span class='va'>N</span><span class='op'>)</span><span class='op'>]</span>
       <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>freqs</span><span class='op'>$</span><span class='va'>disGroup</span>, <span class='va'>freqs</span><span class='op'>$</span><span class='va'>cumSum</span>, addTo <span class='op'>=</span> <span class='st'>"CumulativeNumberSettled"</span>,
            title <span class='op'>=</span> <span class='st'>"Cumulative Number Settled"</span><span class='op'>)</span> <span class='co'># can plot the distance X number</span>
       <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>meanAdvectionMag</span> <span class='op'>+</span> <span class='va'>meanDist</span><span class='op'>)</span>
       <span class='va'>newTitle</span> <span class='op'>&lt;-</span> <span class='st'>"Number Settled By Distance"</span>
       <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>freqs</span><span class='op'>$</span><span class='va'>disGroup</span>, <span class='va'>freqs</span><span class='op'>$</span><span class='va'>N</span>, addTo <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>gsub</a></span><span class='op'>(</span><span class='st'>" "</span>, <span class='st'>""</span>, <span class='va'>newTitle</span><span class='op'>)</span>,
            title <span class='op'>=</span> <span class='va'>newTitle</span><span class='op'>)</span> <span class='co'># can plot the distance X number</span>
       <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v <span class='op'>=</span> <span class='va'>meanAdvectionMag</span> <span class='op'>+</span> <span class='va'>meanDist</span><span class='op'>)</span>
       <span class='co'># should be 0.63:</span>
       <span class='va'>freqs</span><span class='op'>[</span><span class='va'>disGroup</span> <span class='op'>==</span> <span class='va'>meanAdvectionMag</span> <span class='op'>+</span> <span class='va'>meanDist</span>, <span class='va'>cumSum</span><span class='op'>]</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/headtail.html'>tail</a></span><span class='op'>(</span><span class='va'>freqs</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>[</span>, <span class='va'>cumSum</span><span class='op'>]</span>
       <span class='fu'><a href='https://rdrr.io/r/graphics/mtext.html'>mtext</a></span><span class='op'>(</span>side <span class='op'>=</span> <span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"Average habitat quality: "</span>,
             <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>[</span><span class='op'>]</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>,
             outer <span class='op'>=</span> <span class='cn'>TRUE</span>, line <span class='op'>=</span> <span class='op'>-</span><span class='fl'>2</span>, cex <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
    <span class='op'>}</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/dev.html'>dev</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># don't use Rstudio windows, which is very slow</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
    <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>spread3</span><span class='op'>(</span>rasAbundance <span class='op'>=</span> <span class='va'>rasAbundance</span>,
                   rasQuality <span class='op'>=</span> <span class='va'>rasQuality</span>,
                   advectionDir <span class='op'>=</span> <span class='va'>advectionDir</span>,
                   advectionMag <span class='op'>=</span> <span class='va'>advectionMag</span>,
                   meanDist <span class='op'>=</span> <span class='va'>meanDist</span>, verbose <span class='op'>=</span> <span class='fl'>2</span>,
                   plot.it <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>

    <span class='fu'>plotDispersalKernel</span><span class='op'>(</span><span class='va'>out</span>, <span class='va'>advectionMag</span><span class='op'>)</span>
  <span class='op'>}</span>

  <span class='co'>#########################################################</span>
  <span class='co'>### The case of variable quality raster</span>
  <span class='co'>#########################################################</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://r-spatial.github.io/sf/'>sf</a></span><span class='op'>)</span> <span class='op'>&amp;&amp;</span> <span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/ecohealthalliance/fasterize'>fasterize</a></span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://spades-tools.predictiveecology.org'>SpaDES.tools</a></span><span class='op'>)</span> <span class='co'># for gaussMap</span>
    <span class='va'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='randomStudyArea.html'>randomStudyArea</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>1e9</span><span class='op'>)</span>
    <span class='va'>ras</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extent.html'>extent</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, res <span class='op'>=</span> <span class='fl'>100</span><span class='op'>)</span>
    <span class='va'>mask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/fasterize/man/fasterize.html'>fasterize</a></span><span class='op'>(</span><span class='fu'><a href='https://r-spatial.github.io/sf/reference/st_as_sf.html'>st_as_sf</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>, <span class='va'>ras</span><span class='op'>)</span> <span class='co'># faster than raster::rasterize</span>
    <span class='va'>rasQuality</span> <span class='op'>&lt;-</span> <span class='fu'><a href='gaussMap.html'>gaussMap</a></span><span class='op'>(</span><span class='va'>ras</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>a</span><span class='op'>)</span>
    <span class='va'>rasQuality</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>mask</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>
    <span class='co'># rescale so min is 0.75 and max is 1</span>
    <span class='va'>rasQuality</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>rasQuality</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extremeValues.html'>maxValue</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>4</span> <span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>/</span><span class='fl'>4</span>
    <span class='va'>rasAbundance</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span>
    <span class='va'>rasAbundance</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
    <span class='va'>startPixel</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>rasAbundance</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>300</span><span class='op'>)</span>
    <span class='va'>rasAbundance</span><span class='op'>[</span><span class='va'>startPixel</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
    <span class='va'>advectionDir</span> <span class='op'>&lt;-</span> <span class='fl'>75</span>
    <span class='va'>advectionMag</span> <span class='op'>&lt;-</span> <span class='fl'>4</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/resolution.html'>res</a></span><span class='op'>(</span><span class='va'>rasAbundance</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>
    <span class='va'>meanDist</span> <span class='op'>&lt;-</span> <span class='fl'>2600</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
    <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>spread3</span><span class='op'>(</span>rasAbundance <span class='op'>=</span> <span class='va'>rasAbundance</span>,
                   rasQuality <span class='op'>=</span> <span class='va'>rasQuality</span>,
                   advectionDir <span class='op'>=</span> <span class='va'>advectionDir</span>,
                   advectionMag <span class='op'>=</span> <span class='va'>advectionMag</span>,
                   meanDist <span class='op'>=</span> <span class='va'>meanDist</span>, verbose <span class='op'>=</span> <span class='fl'>2</span>,
                   plot.it <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
    <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='fu'>plotDispersalKernel</span><span class='op'>(</span><span class='va'>out</span>, <span class='va'>advectionMag</span><span class='op'>)</span>
    <span class='op'>}</span>
  <span class='op'>}</span>

  <span class='co'>###############################################################################</span>
  <span class='co'>### The case of variable quality raster, raster for advectionDir &amp; advectionMag</span>
  <span class='co'>###############################################################################</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/raster'>raster</a></span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://quickplot.predictiveecology.org'>quickPlot</a></span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://spades-tools.predictiveecology.org'>SpaDES.tools</a></span><span class='op'>)</span>
  <span class='va'>maxDim</span> <span class='op'>&lt;-</span> <span class='fl'>10000</span>
  <span class='va'>ras</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extent.html'>extent</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>maxDim</span>, <span class='fl'>0</span>, <span class='va'>maxDim</span><span class='op'>)</span><span class='op'>)</span>, res <span class='op'>=</span> <span class='fl'>100</span>, vals <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>
  <span class='va'>rasQuality</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>ras</span><span class='op'>)</span>
  <span class='va'>rasQuality</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
  <span class='va'>rasAbundance</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span>
  <span class='va'>rasAbundance</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>
  <span class='co'># startPixel &lt;- middlePixel(rasAbundance)</span>
  <span class='va'>startPixel</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>rasAbundance</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>25</span><span class='op'>)</span>
  <span class='va'>rasAbundance</span><span class='op'>[</span><span class='va'>startPixel</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>

  <span class='co'># raster for advectionDir</span>
  <span class='va'>advectionDir</span> <span class='op'>&lt;-</span> <span class='fu'><a href='gaussMap.html'>gaussMap</a></span><span class='op'>(</span><span class='va'>ras</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>advectionDir</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span>
  <span class='co'># rescale so min is 0.75 and max is 1</span>
  <span class='va'>advectionDir</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>advectionDir</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extremeValues.html'>maxValue</a></span><span class='op'>(</span><span class='va'>advectionDir</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>180</span>

  <span class='co'># raster for advectionMag</span>
  <span class='va'>advectionMag</span> <span class='op'>&lt;-</span> <span class='fu'><a href='gaussMap.html'>gaussMap</a></span><span class='op'>(</span><span class='va'>ras</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>advectionMag</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/projection.html'>crs</a></span><span class='op'>(</span><span class='va'>rasQuality</span><span class='op'>)</span>
  <span class='co'># rescale so min is 0.75 and max is 1</span>
  <span class='va'>advectionMag</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>advectionMag</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>/</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extremeValues.html'>maxValue</a></span><span class='op'>(</span><span class='va'>advectionMag</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>600</span>

  <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>spread3</span><span class='op'>(</span>rasAbundance <span class='op'>=</span> <span class='va'>rasAbundance</span>,
                 rasQuality <span class='op'>=</span> <span class='va'>rasQuality</span>,
                 advectionDir <span class='op'>=</span> <span class='va'>advectionDir</span>,
                 advectionMag <span class='op'>=</span> <span class='va'>advectionMag</span>,
                 meanDist <span class='op'>=</span> <span class='va'>meanDist</span>, verbose <span class='op'>=</span> <span class='fl'>2</span>,
                 plot.it <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>

  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/dev.html'>dev</a></span><span class='op'>(</span><span class='op'>)</span> <span class='co'># don't use Rstudio windows, which is very slow</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>advectionDir</span>, title <span class='op'>=</span> <span class='st'>"Wind direction"</span>, cols <span class='op'>=</span> <span class='st'>"Reds"</span><span class='op'>)</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>advectionMag</span>, title <span class='op'>=</span> <span class='st'>"Wind speed"</span>, cols <span class='op'>=</span> <span class='st'>"Blues"</span><span class='op'>)</span>
    <span class='fu'>plotDispersalKernel</span><span class='op'>(</span><span class='va'>out</span>, <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>advectionMag</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
    <span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>rasAbundance</span>, addTo <span class='op'>=</span> <span class='st'>"rasAbundance"</span>, cols <span class='op'>=</span> <span class='st'>"black"</span>, title <span class='op'>=</span> <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>}</span>

  <span class='co'>#########################################</span>
  <span class='co'># save iterations to a stack to make animated GIF</span>
  <span class='co'>########################################</span>
  <span class='va'>tmpStack</span> <span class='op'>&lt;-</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/rasterTmpFile.html'>rasterTmpFile</a></span><span class='op'>(</span><span class='st'>"stackToAnimate"</span><span class='op'>)</span>
  <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>spread3</span><span class='op'>(</span>rasAbundance <span class='op'>=</span> <span class='va'>rasAbundance</span>,
                 rasQuality <span class='op'>=</span> <span class='va'>rasQuality</span>,
                 advectionDir <span class='op'>=</span> <span class='va'>advectionDir</span>,
                 advectionMag <span class='op'>=</span> <span class='va'>advectionMag</span>,
                 meanDist <span class='op'>=</span> <span class='fl'>2600</span>, verbose <span class='op'>=</span> <span class='fl'>2</span>,
                 plot.it <span class='op'>=</span> <span class='fl'>0</span>, saveStack <span class='op'>=</span> <span class='va'>tmpStack</span><span class='op'>)</span>

  <span class='co'>## This animates the series of images into an animated GIF</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://yihui.name/animation'>animation</a></span>, quietly <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>out2</span> <span class='op'>&lt;-</span> <span class='fu'>raster</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/stack.html'>stack</a></span><span class='op'>(</span><span class='va'>tmpStack</span><span class='op'>)</span>
    <span class='va'>gifName</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='st'>"animation.gif"</span><span class='op'>)</span>
    <span class='fu'><a href='https://rdrr.io/pkg/animation/man/saveGIF.html'>saveGIF</a></span><span class='op'>(</span>interval <span class='op'>=</span> <span class='fl'>0.1</span>, movie.name <span class='op'>=</span> <span class='va'>gifName</span>, expr <span class='op'>=</span> <span class='op'>{</span>
      <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/numLayers.html'>numLayers</a></span><span class='op'>(</span><span class='va'>out2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/plot.html'>plot</a></span><span class='op'>(</span><span class='va'>out2</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
    <span class='op'>}</span><span class='op'>)</span>
  <span class='op'>}</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


