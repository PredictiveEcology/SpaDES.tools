<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Simulate a spread process on a landscape. — spread • SpaDES.tools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Simulate a spread process on a landscape. — spread" />
<meta property="og:description" content="This can be used to simulate fires, seed dispersal, calculation of iterative,
concentric landscape values (symmetric or asymmetric) and many other things.
Essentially, it starts from a collection of cells (loci) and spreads
to neighbours, according to the directions and spreadProb arguments.
This can become quite general, if spreadProb is 1 as it will expand
from every loci until all cells in the landscape have been covered.
With id set to TRUE, the resulting map will be classified
by the index of the cell where that event propagated from.
This can be used to examine things like fire size distributions.
NOTE: See also spread2, which is more robust and can be
used to build custom functions.
However, under some conditions, this spread function is faster.
The two functions can accomplish many of the same things, and key differences
are internal." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.tools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PredictiveEcology/SpaDES.tools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate a spread process on a landscape.</h1>
    <small class="dont-index">Source: <a href='https://github.com/PredictiveEcology/SpaDES.tools/blob/master/R/spread.R'><code>R/spread.R</code></a></small>
    <div class="hidden name"><code>spread.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This can be used to simulate fires, seed dispersal, calculation of iterative,
concentric landscape values (symmetric or asymmetric) and many other things.
Essentially, it starts from a collection of cells (<code>loci</code>) and spreads
to neighbours, according to the <code>directions</code> and <code>spreadProb</code> arguments.
This can become quite general, if <code>spreadProb</code> is 1 as it will expand
from every loci until all cells in the landscape have been covered.
With <code>id</code> set to <code>TRUE</code>, the resulting map will be classified
by the index of the cell where that event propagated from.
This can be used to examine things like fire size distributions.
<b>NOTE:</b> See also <code><a href='spread2.html'>spread2</a></code>, which is more robust and can be
used to build custom functions.
However, under some conditions, this <code>spread</code> function is faster.
The two functions can accomplish many of the same things, and key differences
are internal.</p>
    </div>

    <pre class="usage"><span class='fu'>spread</span><span class='op'>(</span>
  <span class='va'>landscape</span>,
  loci <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  spreadProb <span class='op'>=</span> <span class='fl'>0.23</span>,
  persistence <span class='op'>=</span> <span class='fl'>0</span>,
  mask <span class='op'>=</span> <span class='cn'>NA</span>,
  maxSize <span class='op'>=</span> <span class='fl'>100000000L</span>,
  directions <span class='op'>=</span> <span class='fl'>8L</span>,
  iterations <span class='op'>=</span> <span class='fl'>1000000L</span>,
  lowMemory <span class='op'>=</span> <span class='cn'>NULL</span>,
  returnIndices <span class='op'>=</span> <span class='cn'>FALSE</span>,
  returnDistances <span class='op'>=</span> <span class='cn'>FALSE</span>,
  mapID <span class='op'>=</span> <span class='cn'>NULL</span>,
  id <span class='op'>=</span> <span class='cn'>FALSE</span>,
  plot.it <span class='op'>=</span> <span class='cn'>FALSE</span>,
  spreadProbLater <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  spreadState <span class='op'>=</span> <span class='cn'>NA</span>,
  circle <span class='op'>=</span> <span class='cn'>FALSE</span>,
  circleMaxRadius <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  stopRule <span class='op'>=</span> <span class='cn'>NA</span>,
  stopRuleBehavior <span class='op'>=</span> <span class='st'>"includeRing"</span>,
  allowOverlap <span class='op'>=</span> <span class='cn'>FALSE</span>,
  asymmetry <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  asymmetryAngle <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  quick <span class='op'>=</span> <span class='cn'>FALSE</span>,
  neighProbs <span class='op'>=</span> <span class='cn'>NULL</span>,
  exactSizes <span class='op'>=</span> <span class='cn'>FALSE</span>,
  relativeSpreadProb <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='co'># S4 method for RasterLayer</span>
<span class='fu'>spread</span><span class='op'>(</span>
  <span class='va'>landscape</span>,
  loci <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  spreadProb <span class='op'>=</span> <span class='fl'>0.23</span>,
  persistence <span class='op'>=</span> <span class='fl'>0</span>,
  mask <span class='op'>=</span> <span class='cn'>NA</span>,
  maxSize <span class='op'>=</span> <span class='fl'>100000000L</span>,
  directions <span class='op'>=</span> <span class='fl'>8L</span>,
  iterations <span class='op'>=</span> <span class='fl'>1000000L</span>,
  lowMemory <span class='op'>=</span> <span class='cn'>NULL</span>,
  returnIndices <span class='op'>=</span> <span class='cn'>FALSE</span>,
  returnDistances <span class='op'>=</span> <span class='cn'>FALSE</span>,
  mapID <span class='op'>=</span> <span class='cn'>NULL</span>,
  id <span class='op'>=</span> <span class='cn'>FALSE</span>,
  plot.it <span class='op'>=</span> <span class='cn'>FALSE</span>,
  spreadProbLater <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  spreadState <span class='op'>=</span> <span class='cn'>NA</span>,
  circle <span class='op'>=</span> <span class='cn'>FALSE</span>,
  circleMaxRadius <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  stopRule <span class='op'>=</span> <span class='cn'>NA</span>,
  stopRuleBehavior <span class='op'>=</span> <span class='st'>"includeRing"</span>,
  allowOverlap <span class='op'>=</span> <span class='cn'>FALSE</span>,
  asymmetry <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  asymmetryAngle <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  quick <span class='op'>=</span> <span class='cn'>FALSE</span>,
  neighProbs <span class='op'>=</span> <span class='cn'>NULL</span>,
  exactSizes <span class='op'>=</span> <span class='cn'>FALSE</span>,
  relativeSpreadProb <span class='op'>=</span> <span class='cn'>FALSE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>landscape</th>
      <td><p>A <code>RasterLayer</code> object. This defines the possible
locations for spreading events to start and spread into.
This can also be used as part of <code>stopRule</code>.</p></td>
    </tr>
    <tr>
      <th>loci</th>
      <td><p>A vector of locations in <code>landscape</code>.
These should be cell indices.
If user has x and y coordinates, these can be converted
with <code>cellFromXY</code>.</p></td>
    </tr>
    <tr>
      <th>spreadProb</th>
      <td><p>Numeric, or <code>RasterLayer</code>.
If numeric of length 1, then this is the global probability
of spreading into each cell from a neighbour.
If a raster (or a vector of length <code><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell(landscape)</a></code>,
resolution and extent of <code>landscape</code>), then this will
be the cell-specific probability. Default is <code>0.23</code>.
If a <code>spreadProbLater</code> is provided, then this is
only used for the first iteration. Also called "escape
probability". See section on "Breaking out of spread events".</p></td>
    </tr>
    <tr>
      <th>persistence</th>
      <td><p>A length 1 probability that an active cell will continue
to burn, per time step.</p></td>
    </tr>
    <tr>
      <th>mask</th>
      <td><p>non-<code>NULL</code>, a <code>RasterLayer</code> object congruent with
<code>landscape</code> whose elements are <code>0,1</code>, where
<code>1</code> indicates "cannot spread to".
Currently not implemented, but identical behaviour can be
achieved if <code>spreadProb</code> has zeros in all unspreadable
locations.</p></td>
    </tr>
    <tr>
      <th>maxSize</th>
      <td><p>Numeric. Maximum number of cells for a single or
all events to be spread. Recycled to match <code>loci</code> length,
if it is not as long as <code>loci</code>.
See section on <code>Breaking out of spread events</code>.</p></td>
    </tr>
    <tr>
      <th>directions</th>
      <td><p>The number of adjacent cells in which to look;
default is 8 (Queen case). Can only be 4 or 8.</p></td>
    </tr>
    <tr>
      <th>iterations</th>
      <td><p>Number of iterations to spread.
Leaving this <code>NULL</code> allows the spread to continue
until stops spreading itself (i.e., exhausts itself).</p></td>
    </tr>
    <tr>
      <th>lowMemory</th>
      <td><p>Deprecated.</p></td>
    </tr>
    <tr>
      <th>returnIndices</th>
      <td><p>Logical or numeric. If <code>1</code> or <code>TRUE</code>, will
return a <code>data.table</code> with indices and values of
successful spread events.
If <code>2</code>, it will simply return a vector of pixel indices of
all cells that were touched. This will be the fastest option. If
<code>FALSE</code>, then it will return a raster with
values. See Details.</p></td>
    </tr>
    <tr>
      <th>returnDistances</th>
      <td><p>Logical. Should the function include a column with the
individual cell distances from the locus where that event
started. Default is <code>FALSE</code>. See Details.</p></td>
    </tr>
    <tr>
      <th>mapID</th>
      <td><p>Deprecated. Use <code>id</code>.</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>Logical. If <code>TRUE</code>, returns a raster of events ids.
If <code>FALSE</code>, returns a raster of iteration numbers,
i.e., the spread history of one or more events.
NOTE: this is overridden if <code>returnIndices</code> is <code>TRUE</code>
or <code>1</code> or <code>2</code>.</p></td>
    </tr>
    <tr>
      <th>plot.it</th>
      <td><p>If <code>TRUE</code>, then plot the raster at every iteration,
so one can watch the spread event grow.</p></td>
    </tr>
    <tr>
      <th>spreadProbLater</th>
      <td><p>Numeric, or <code>RasterLayer</code>. If provided, then this
will become the spreadProb after the first iteration.
See Details.</p></td>
    </tr>
    <tr>
      <th>spreadState</th>
      <td><p><code>data.table</code>. This should be the output of a previous call
to <code>spread</code>, where <code>returnIndices</code> was <code>TRUE</code>.
Default <code>NA</code>, meaning the spread is starting from <code>loci</code>.
See Details.</p></td>
    </tr>
    <tr>
      <th>circle</th>
      <td><p>Logical. If <code>TRUE</code>, then outward spread will be by
equidistant rings, rather than solely by adjacent cells
(via <code>directions</code> arg.). Default is <code>FALSE</code>.
Using <code>circle = TRUE</code> can be dramatically slower for
large problems.
Note, this should usually be used with <code>spreadProb = 1</code>.</p></td>
    </tr>
    <tr>
      <th>circleMaxRadius</th>
      <td><p>Numeric. A further way to stop the outward spread of events.
If <code>circle</code> is <code>TRUE</code>, then it will grow to this maximum radius.
See section on <code>Breaking out of spread events</code>.
Default is <code>NA</code>.</p></td>
    </tr>
    <tr>
      <th>stopRule</th>
      <td><p>A function which will be used to assess whether each
individual cluster should stop growing.
This function can be an argument of <code>"landscape"</code>,
<code>"id"</code>, <code>"cells"</code>, and any other named vectors,
a named list of named vectors, or a named <code>data.frame</code>
with column names passed to <code>spread</code> in the <code>...</code>.
Default <code>NA</code>, meaning that spreading will not stop
as a function of the landscape.
See section on "Breaking out of spread events" and examples.</p></td>
    </tr>
    <tr>
      <th>stopRuleBehavior</th>
      <td><p>Character. Can be one of <code>"includePixel"</code>,
<code>"excludePixel"</code>, <code>"includeRing"</code>, or
<code>"excludeRing"</code>.
If <code>stopRule</code> contains a function, this argument is
used determine what to do with the cell(s) that caused
the rule to be <code>TRUE</code>. See details.
Default is <code>"includeRing"</code> which means to accept the
entire ring of cells that caused the rule to be <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>allowOverlap</th>
      <td><p>Logical. If <code>TRUE</code>, then individual events can overlap
with one another, i.e., they do not interact (this is slower
than if <code>allowOverlap = FALSE</code>).
Default is <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>asymmetry</th>
      <td><p>A numeric indicating the ratio of the asymmetry to be used.
Default is <code>NA</code>, indicating no asymmetry.
See details. This is still experimental.
<b>Use with caution.</b></p></td>
    </tr>
    <tr>
      <th>asymmetryAngle</th>
      <td><p>A numeric indicating the angle in degrees (0 is "up",
as in North on a map), that describes which way the
<code>asymmetry</code> is.</p></td>
    </tr>
    <tr>
      <th>quick</th>
      <td><p>Logical. If <code>TRUE</code>, then several potentially time consuming
checking (such as <code>inRange</code>) will be skipped.
This should only be used if there is no concern about checking
to ensure that inputs are legal.</p></td>
    </tr>
    <tr>
      <th>neighProbs</th>
      <td><p>A numeric vector, whose sum is 1.
It indicates the probabilities an individual spread iteration
spreading to <code>1:length(neighProbs)</code> neighbours.</p></td>
    </tr>
    <tr>
      <th>exactSizes</th>
      <td><p>Logical. If <code>TRUE</code>, then the <code>maxSize</code> will be
treated as exact sizes, i.e., the spread events will continue
until they are <code><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>floor(maxSize)</a></code>.
This is overridden by <code>iterations</code>, but if <code>iterations</code>
is run, and individual events haven't reached <code>maxSize</code>,
then the returned <code>data.table</code> will still have at least
one active cell per event that did not achieve <code>maxSize</code>,
so that the events can continue if passed into <code>spread</code>
with <code>spreadState</code>.</p></td>
    </tr>
    <tr>
      <th>relativeSpreadProb</th>
      <td><p>Logical. If <code>TRUE</code>, then <code>spreadProb</code> will
be rescaled *within* the <code>directions</code> neighbours, such that
the sum of the probabilities of all neighbours will be 1. Default
<code>FALSE</code>, unless <code>spreadProb</code> values are not contained
between 0 and 1, which will force <code>relativeSpreadProb</code>
to be <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional named vectors or named list of named vectors
required for <code>stopRule</code>. These
vectors should be as long as required e.g., length
<code>loci</code> if there is one value per event.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Either a <code>RasterLayer</code> indicating the spread of the process in
the landscape or a <code>data.table</code> if <code>returnIndices</code> is <code>TRUE</code>.
If a <code>RasterLayer</code>, then it represents
every cell in which a successful spread event occurred. For the case of, say, a fire
this would represent every cell that burned. If <code>allowOverlap</code> is <code>TRUE</code>,
This <code>RasterLayer</code> will represent the sum of the individual event ids
(which are numerics <code><a href='https://rdrr.io/r/base/seq.html'>seq_along(loci)</a></code>.
This will generally be of minimal use because it won't be possible to distinguish
if event 2 overlapped with event 5 or if it was just event 7.</p>
<p>If <code>returnIndices</code> is <code>TRUE</code>,
then this function returns a <code>data.table</code> with columns:</p>
<table class='table'>
<tr><td><code>id</code></td><td>an arbitrary ID <code>1:length(loci)</code> identifying
                     unique clusters of spread events, i.e., all cells
                     that have been spread into that have a
                     common initial cell.</td></tr>
<tr><td><code>initialLocus</code></td><td>the initial cell number of that particular
                           spread event.</td></tr>
<tr><td><code>indices</code></td><td>The cell indices of cells that have
                       been touched by the spread algorithm.</td></tr>
<tr><td><code>active</code></td><td>a logical indicating whether the cell is active (i.e.,
                       could still be a source for spreading) or not (no
                       spreading will occur from these cells).</td></tr>
</table>


<p>This will generally be more useful when <code>allowOverlap</code> is <code>TRUE</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For large rasters, a combination of <code>lowMemory = TRUE</code> and
<code>returnIndices = TRUE</code> or <code>returnIndices = 2</code>
will be fastest and use the least amount of memory.</p>
<p>This function can be interrupted before all active cells are exhausted if
the <code>iterations</code> value is reached before there are no more active
cells to spread into. If this is desired, <code>returnIndices</code> should be
<code>TRUE</code> and the output of this call can be passed subsequently as an input
to this same function. This is intended to be used for situations where external
events happen during a spread event, or where one or more arguments to the spread
function change before a spread event is completed. For example, if it is
desired that the <code>spreadProb</code> change before a spread event is completed because,
for example, a fire is spreading, and a new set of conditions arise due to
a change in weather.</p>
<p><code>asymmetry</code> is currently used to modify the <code>spreadProb</code> in the following way.
First for each active cell, spreadProb is converted into a length 2 numeric of Low and High
spread probabilities for that cell:
<code>spreadProbsLH &lt;- (spreadProb*2) // (asymmetry+1)*c(1,asymmetry)</code>,
whose ratio is equal to
<code>asymmetry</code>.
Then, using <code>asymmetryAngle</code>, the angle between the
initial starting point of the event and all potential
cells is found. These are converted into a proportion of the angle from
<code>-asymmetryAngle</code>
to
<code>asymmetryAngle</code>
using:
<code>angleQuality &lt;- (cos(angles - rad(asymmetryAngle))+1)/2</code></p>
<p>These are then converted to multiple spreadProbs by
<code>spreadProbs &lt;- lowSpreadProb+(angleQuality * diff(spreadProbsLH))</code>
To maintain an expected <code>spreadProb</code> that is the same as the asymmetric
<code>spreadProbs</code>, these are then rescaled so that the mean of the
asymmetric spreadProbs is always equal to spreadProb at every iteration:
<code>spreadProbs &lt;- spreadProbs - diff(c(spreadProb,mean(spreadProbs)))</code></p>
    <h2 class="hasAnchor" id="breaking-out-of-spread-events"><a class="anchor" href="#breaking-out-of-spread-events"></a>Breaking out of spread events</h2>

    


<p>There are 4 ways for the spread to "stop" spreading. Here, each "event" is defined as
all cells that are spawned from a single starting loci. So, one spread call can have
multiple spreading "events". The ways outlines below are all acting at all times,
i.e., they are not mutually exclusive. Therefore, it is the user's
responsibility to make sure the different rules are interacting with
each other correctly. Using <code>spreadProb</code> or <code>maxSize</code> are computationally
fastest, sometimes dramatically so.</p>
<table class='table'>
<tr><td><code>spreadProb</code></td><td>Probabilistically, if spreadProb is low enough,
                         active spreading events will stop. In practice,
                         active spreading events will stop. In practice,
                         this number generally should be below 0.3 to actually
                         see an event stop</td></tr>
<tr><td><code>maxSize</code></td><td>This is the number of cells that are "successfully" turned
                      on during a spreading event. This can be vectorized, one value
                      for each event</td></tr>
<tr><td><code>circleMaxRadius</code></td><td>If <code>circle</code> is TRUE, then this will be the maximum
                      radius reached, and then the event will stop. This is
                      vectorized, and if length is &gt;1, it will be matched
                      in the order of <code>loci</code></td></tr>
<tr><td><code>stopRule</code></td><td>This is a function that can use "landscape", "id", "cells",
                      or any named vector passed into <code>spread</code> in the <code>...</code>.
                      This can take on relatively complex functions.
                      Passing in, say, a <code>RasterLayer</code> to <code>spread</code>
                      can access the individual values on that arbitrary
                      <code>RasterLayer</code> using "cells".
                      These will be calculated within all the cells of the individual
                      event (equivalent to a "group_by(event)" in <code>dplyr</code>.
                      So, <code><a href='https://rdrr.io/r/base/sum.html'>sum(arbitraryRaster[cells])</a></code> would sum up all
                      the raster values on the <code>arbitraryRaster</code> raster
                      that are overlaid by the individual event.
                      This can then be used in a logical statement. See examples.
                      To confirm the cause of stopping, the user can assess the values
                      after the function has finished.</td></tr>
</table>


<p>The spread function does not return the result of this stopRule. If,
say, an event has both <code>circleMaxRadius</code> and <code>stopRule</code>,
and it is
the <code>circleMaxRadius</code> that caused the event spreading to stop,
there will be no indicator returned from this function that indicates
which rule caused the stop.</p>
<p><code>stopRule</code> has many use cases. One common use case is evaluating
a neighbourhood around a focal set of points. This provides,
therefore, an alternative to the <code><a href='https://rdrr.io/pkg/raster/man/buffer.html'>buffer</a></code> function or
<code><a href='https://rdrr.io/pkg/raster/man/focal.html'>focal</a></code> function.
In both of those cases, the window/buffer size must be an input to the function. Here,
the resulting size can be emergent based on the incremental growing and calculating
of the <code>landscape</code> values underlying the spreading event.</p>
    <h2 class="hasAnchor" id="stoprulebehavior"><a class="anchor" href="#stoprulebehavior"></a><code>stopRuleBehavior</code></h2>

    

<p>This determines how the <code>stopRule</code> should be implemented. Because
spreading occurs outwards in concentric circles or shapes, one cell width at a time, there
are 4 possible ways to interpret the logical inequality defined in <code>stopRule</code>.
In order of number of cells included in resulting events, from most cells to fewest cells:</p>
<table class='table'>
<tr><td><code>"includeRing"</code></td><td>Will include the entire ring of cells that, as a group,
                            caused <code>stopRule</code> to be <code>TRUE</code>.</td></tr>
<tr><td><code>"includePixel"</code></td><td>Working backwards from the entire ring that caused the
                             <code>stopRule</code> to be <code>TRUE</code>, this will iteratively
                             random cells in the final ring
                             until the <code>stopRule</code> is <code>FALSE</code>. This will add back
                             the last removed cell and include it in the return result
                             for that event.</td></tr>
<tr><td><code>"excludePixel"</code></td><td>Like <code>"includePixel"</code>, but it will not add back the cell
                       that causes <code>stopRule</code> to be <code>TRUE</code></td></tr>
<tr><td><code>"excludeRing"</code></td><td>Analogous to <code>"excludePixel"</code>, but for the entire final
                            ring of cells added. This will exclude the entire ring of cells
                            that caused the <code>stopRule</code> to be <code>TRUE</code></td></tr>
</table>


    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='spread2.html'>spread2</a></code> for a different implementation of the same algorithm.
It is more robust, meaning, there will be fewer unexplainable errors, and the behaviour
has been better tested, so it is more likely to be exactly as described under all
argument combinations.
Also, <code><a href='rings.html'>rings</a></code> which uses <code>spread</code> but with specific argument
values selected for a specific purpose.
<code><a href='https://rdrr.io/pkg/raster/man/distanceFromPoints.html'>distanceFromPoints</a></code>.
<code><a href='cir.html'>cir</a></code> to create "circles"; it is fast for many small problems.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Eliot McIntire and Steve Cumming</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rspatial.org/raster'>raster</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>RColorBrewer</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://quickplot.predictiveecology.org'>quickPlot</a></span><span class='op'>)</span>

<span class='co'># Make random forest cover map</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>123</span><span class='op'>)</span>
<span class='va'>emptyRas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/extent.html'>extent</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1e2</span>, <span class='fl'>0</span>, <span class='fl'>1e2</span><span class='op'>)</span>, res <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>hab</span> <span class='op'>&lt;-</span> <span class='fu'><a href='randomPolygons.html'>randomPolygons</a></span><span class='op'>(</span><span class='va'>emptyRas</span>, numTypes <span class='op'>=</span> <span class='fl'>40</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/raster/man/names.html'>names</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='st'>"hab"</span>
<span class='va'>mask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>emptyRas</span><span class='op'>)</span>
<span class='va'>mask</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/setValues.html'>setValues</a></span><span class='op'>(</span><span class='va'>mask</span>, <span class='fl'>0</span><span class='op'>)</span>
<span class='va'>mask</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5000</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='va'>numCol</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncol</a></span><span class='op'>(</span><span class='va'>emptyRas</span><span class='op'>)</span>
<span class='va'>numCell</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>emptyRas</span><span class='op'>)</span>
<span class='va'>directions</span> <span class='op'>&lt;-</span> <span class='fl'>8</span>

<span class='co'># Can use transparent as a colour</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/getSetColors.html'>setColors</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"transparent"</span>, <span class='fu'><a href='https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html'>brewer.pal</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='st'>"Greys"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># note speedup is equivalent to making pyramids, so, some details are lost</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>hab</span>, speedup <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='spread-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># initiate 10 fires</span>
<span class='va'>startCells</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>emptyRas</span><span class='op'>)</span>, <span class='fl'>100</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>fires</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='va'>startCells</span>, <span class='fl'>0.235</span>, persistence <span class='op'>=</span> <span class='fl'>0</span>, numNeighs <span class='op'>=</span> <span class='fl'>2</span>,
                mask <span class='op'>=</span> <span class='cn'>NULL</span>, maxSize <span class='op'>=</span> <span class='fl'>1e8</span>, directions <span class='op'>=</span> <span class='fl'>8</span>, iterations <span class='op'>=</span> <span class='fl'>1e6</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'>#set colours of raster, including a transparent layer for zeros</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/getSetColors.html'>setColors</a></span><span class='op'>(</span><span class='va'>fires</span>, <span class='fl'>10</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"transparent"</span>, <span class='fu'><a href='https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html'>brewer.pal</a></span><span class='op'>(</span><span class='fl'>8</span>, <span class='st'>"Reds"</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>5</span><span class='op'>:</span><span class='fl'>8</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span>, addTo <span class='op'>=</span> <span class='st'>"hab"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>#alternatively, set colours using cols= in the Plot function</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>
</div><div class='img'><img src='spread-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span><span class='op'>)</span> <span class='co'># default colour range makes zero transparent.</span>
</div><div class='input'>
<span class='co'># Instead, to give a colour to the zero values, use \code{zero.color=}</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span>, addTo <span class='op'>=</span> <span class='st'>"hab"</span>,
     cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/colorRamp.html'>colorRampPalette</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"orange"</span>, <span class='st'>"darkred"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>, zero.color <span class='op'>=</span> <span class='st'>"transparent"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-4.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='va'>hab2</span> <span class='op'>&lt;-</span> <span class='va'>hab</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>hab2</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span>, addTo <span class='op'>=</span> <span class='st'>"hab2"</span>, zero.color <span class='op'>=</span> <span class='st'>"transparent"</span>,
   cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/colorRamp.html'>colorRampPalette</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"orange"</span>, <span class='st'>"darkred"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='input'><span class='co'># or overplot the original (NOTE: legend stays at original values)</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span>, cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/palettes.html'>topo.colors</a></span><span class='op'>(</span><span class='fl'>10</span><span class='op'>)</span>, new <span class='op'>=</span> <span class='cn'>TRUE</span>, zero.color <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-5.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>##------------------------------------------------------------------------------</span>
<span class='co'>## Continue event by passing interrupted object into spreadState</span>
<span class='co'>##------------------------------------------------------------------------------</span>

<span class='co'>## Interrupt a spread event using iterations - need `returnIndices = TRUE` to</span>
<span class='co'>##  use outputs as new inputs in next iteration</span>
<span class='va'>fires</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
                returnIndices <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='fl'>0.235</span>, <span class='fl'>0</span>, <span class='cn'>NULL</span>, <span class='fl'>1e8</span>, <span class='fl'>8</span>, iterations <span class='op'>=</span> <span class='fl'>3</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>fires</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>initialLocus</span><span class='op'>)</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='va'>id</span><span class='op'>]</span>  <span class='co'># See sizes of fires</span>
</div><div class='output co'>#&gt;     id size
#&gt;  1:  1    1
#&gt;  2:  2    4
#&gt;  3:  3    6
#&gt;  4:  4    2
#&gt;  5:  5    9
#&gt;  6:  6   11
#&gt;  7:  7    6
#&gt;  8:  8   11
#&gt;  9:  9   11
#&gt; 10: 10    9</div><div class='input'>
<span class='va'>fires2</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='cn'>NA_real_</span>, returnIndices <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='fl'>0.235</span>, <span class='fl'>0</span>, <span class='cn'>NULL</span>,
                 <span class='fl'>1e8</span>, <span class='fl'>8</span>, iterations <span class='op'>=</span> <span class='fl'>2</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, spreadState <span class='op'>=</span> <span class='va'>fires</span><span class='op'>)</span>
<span class='co'># NOTE events are assigned arbitrary IDs, starting at 1</span>

<span class='co'>## Add new fires to the already burning fires</span>
<span class='va'>fires3</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
                 returnIndices <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='fl'>0.235</span>, <span class='fl'>0</span>, <span class='cn'>NULL</span>, <span class='fl'>1e8</span>, <span class='fl'>8</span>, iterations <span class='op'>=</span> <span class='fl'>1</span>,
                 id <span class='op'>=</span> <span class='cn'>TRUE</span>, spreadState <span class='op'>=</span> <span class='va'>fires</span><span class='op'>)</span>
<span class='va'>fires3</span><span class='op'>[</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>initialLocus</span><span class='op'>)</span><span class='op'>)</span>, by <span class='op'>=</span> <span class='va'>id</span><span class='op'>]</span>  <span class='co'># See sizes of fires</span>
</div><div class='output co'>#&gt;     id size
#&gt;  1:  1    1
#&gt;  2:  2    4
#&gt;  3:  3   14
#&gt;  4:  4    2
#&gt;  5:  5   12
#&gt;  6:  6   16
#&gt;  7:  7   10
#&gt;  8:  8   14
#&gt;  9:  9   16
#&gt; 10: 10   13</div><div class='input'><span class='co'># NOTE old ids are maintained, new events get ids begining above previous</span>
<span class='co'># maximum (e.g., new fires 11 to 20 here)</span>

<span class='co'>## Use data.table and loci...</span>
<span class='va'>fires</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
                returnIndices <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='fl'>0.235</span>, <span class='fl'>0</span>, <span class='cn'>NULL</span>, <span class='fl'>1e8</span>, <span class='fl'>8</span>, iterations <span class='op'>=</span> <span class='fl'>2</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>fullRas</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>
<span class='va'>fullRas</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>
<span class='va'>burned</span> <span class='op'>&lt;-</span> <span class='va'>fires</span><span class='op'>[</span><span class='va'>active</span> <span class='op'>==</span> <span class='cn'>FALSE</span><span class='op'>]</span>
<span class='va'>burnedMap</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rasterizeReduced.html'>rasterizeReduced</a></span><span class='op'>(</span><span class='va'>burned</span>, <span class='va'>fullRas</span>, <span class='st'>"id"</span>, <span class='st'>"indices"</span><span class='op'>)</span>

<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>burnedMap</span>, new <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='img'><img src='spread-6.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>####################</span>
<span class='co'>## stopRule examples</span>
<span class='co'>####################</span>

<span class='co'># examples with stopRule, which means that the eventual size is driven by the values on the raster</span>
<span class='co'>#  passed in to the landscape argument</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1234</span><span class='op'>)</span>
<span class='va'>stopRule1</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>50</span>
<span class='va'>stopRuleA</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='cn'>NULL</span>,
                    maxSize <span class='op'>=</span> <span class='fl'>1e6</span>, <span class='fl'>8</span>, <span class='fl'>1e6</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule1</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1234</span><span class='op'>)</span>
<span class='va'>stopRule2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>100</span>
<span class='co'># using stopRuleBehavior = "excludePixel"</span>
<span class='va'>stopRuleB</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='cn'>NULL</span>,
                    maxSize <span class='op'>=</span> <span class='fl'>1e6</span>, <span class='fl'>8</span>, <span class='fl'>1e6</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule2</span>,
                    stopRuleBehavior <span class='op'>=</span> <span class='st'>"excludePixel"</span><span class='op'>)</span>

<span class='co'># using stopRuleBehavior = "includeRing", means that end result is slightly larger patches, as a</span>
<span class='co'>#  complete "iteration" of the spread algorithm is used.</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>1234</span><span class='op'>)</span>
<span class='va'>stopRuleBNotExact</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>, <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>1</span>, <span class='fl'>0</span>,
                             <span class='cn'>NULL</span>, maxSize <span class='op'>=</span> <span class='fl'>1e6</span>, <span class='fl'>8</span>, <span class='fl'>1e6</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span>,
                             stopRule <span class='op'>=</span> <span class='va'>stopRule2</span><span class='op'>)</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>stopRuleA</span>, <span class='va'>stopRuleB</span>, <span class='va'>stopRuleBNotExact</span><span class='op'>)</span>
</div><div class='img'><img src='spread-7.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Test that the stopRules work</span>
<span class='co'># stopRuleA was not exact, so each value will "overshoot" the stopRule, here it was hab&gt;50</span>
<span class='va'>foo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>vals <span class='op'>=</span> <span class='va'>hab</span><span class='op'>[</span><span class='va'>stopRuleA</span><span class='op'>]</span>, id <span class='op'>=</span> <span class='va'>stopRuleA</span><span class='op'>[</span><span class='va'>stopRuleA</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>;
<span class='fu'><a href='https://rdrr.io/r/base/tapply.html'>tapply</a></span><span class='op'>(</span><span class='va'>foo</span><span class='op'>[</span>, <span class='st'>"vals"</span><span class='op'>]</span>, <span class='va'>foo</span><span class='op'>[</span>, <span class='st'>"id"</span><span class='op'>]</span>, <span class='va'>sum</span><span class='op'>)</span> <span class='co'># Correct ... all are above 50</span>
</div><div class='output co'>#&gt;   1   2   3   4   5   6   7   8   9  10 
#&gt; 185  55  95  95 135 130 165 150 125  90 </div><div class='input'>
<span class='co'># stopRuleB was exact, so each value will be as close as possible while rule still is TRUE</span>
<span class='co'>#  Because we have discrete cells, these numbers will always slightly under the rule</span>
<span class='va'>foo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>vals <span class='op'>=</span> <span class='va'>hab</span><span class='op'>[</span><span class='va'>stopRuleB</span><span class='op'>]</span>, id <span class='op'>=</span> <span class='va'>stopRuleB</span><span class='op'>[</span><span class='va'>stopRuleB</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>;
<span class='fu'><a href='https://rdrr.io/r/base/tapply.html'>tapply</a></span><span class='op'>(</span><span class='va'>foo</span><span class='op'>[</span>, <span class='st'>"vals"</span><span class='op'>]</span>, <span class='va'>foo</span><span class='op'>[</span>, <span class='st'>"id"</span><span class='op'>]</span>, <span class='va'>sum</span><span class='op'>)</span> <span class='co'># Correct ... all are above 50</span>
</div><div class='output co'>#&gt;   1   2   3   4   5   6   7   8   9  10 
#&gt;  74  99  95  95  81 100  99  90  79  90 </div><div class='input'>
<span class='co'># stopRuleB_notExact will overshoot</span>
<span class='va'>foo</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>vals <span class='op'>=</span> <span class='va'>hab</span><span class='op'>[</span><span class='va'>stopRuleBNotExact</span><span class='op'>]</span>, id <span class='op'>=</span> <span class='va'>stopRuleBNotExact</span><span class='op'>[</span><span class='va'>stopRuleBNotExact</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>;
<span class='fu'><a href='https://rdrr.io/r/base/tapply.html'>tapply</a></span><span class='op'>(</span><span class='va'>foo</span><span class='op'>[</span>, <span class='st'>"vals"</span><span class='op'>]</span>, <span class='va'>foo</span><span class='op'>[</span>, <span class='st'>"id"</span><span class='op'>]</span>, <span class='va'>sum</span><span class='op'>)</span> <span class='co'># Correct ... all are above 50</span>
</div><div class='output co'>#&gt;   1   2   3   4   5   6   7   8   9  10 
#&gt; 185 137 247 247 135 130 165 150 125 234 </div><div class='input'>
<span class='co'># Cellular automata shapes</span>
<span class='co'># Diamonds - can make them with: a boolean raster, directions = 4,</span>
<span class='co'>#    stopRule in place, spreadProb = 1</span>
<span class='va'>diamonds</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, spreadProb <span class='op'>=</span> <span class='fl'>1</span>, directions <span class='op'>=</span> <span class='fl'>4</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule2</span><span class='op'>)</span>

<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>diamonds</span><span class='op'>)</span>
</div><div class='img'><img src='spread-8.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Squares - can make them with: a boolean raster, directions = 8,</span>
<span class='co'>#    stopRule in place, spreadProb = 1</span>
<span class='va'>squares</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, spreadProb <span class='op'>=</span> <span class='fl'>1</span>, directions <span class='op'>=</span> <span class='fl'>8</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule2</span><span class='op'>)</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>squares</span><span class='op'>)</span>
</div><div class='img'><img src='spread-9.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Interference shapes - can make them with: a boolean raster, directions = 8,</span>
<span class='co'>#    stopRule in place, spreadProb = 1</span>
<span class='va'>stopRule2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>200</span>
<span class='va'>squashedDiamonds</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, spreadProb <span class='op'>=</span> <span class='fl'>1</span>,
                           loci <span class='op'>=</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncol</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='op'>-</span><span class='fl'>4</span><span class='op'>)</span>,
                           directions <span class='op'>=</span> <span class='fl'>4</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule2</span><span class='op'>)</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>squashedDiamonds</span><span class='op'>)</span>
</div><div class='img'><img src='spread-10.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># Circles with spreadProb &lt; 1 will give "more" circular shapes, but definitely not circles</span>
<span class='va'>stopRule2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>200</span>
<span class='va'>seed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1e4</span>, <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
<span class='va'>circlish</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, spreadProb <span class='op'>=</span> <span class='fl'>0.23</span>,
                   loci <span class='op'>=</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncol</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='op'>-</span><span class='fl'>4</span><span class='op'>)</span>,
                   directions <span class='op'>=</span> <span class='fl'>8</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='co'>#, stopRule = stopRule2)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
<span class='va'>regularCA</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, spreadProb <span class='op'>=</span> <span class='fl'>0.23</span>,
                    loci <span class='op'>=</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncol</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>2</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='op'>-</span><span class='fl'>4</span><span class='op'>)</span>,
                    directions <span class='op'>=</span> <span class='fl'>8</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='co'>#, stopRule = stopRule2)</span>

<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>circlish</span>, <span class='va'>regularCA</span><span class='op'>)</span>
</div><div class='img'><img src='spread-11.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>####################</span>
<span class='co'># complex stopRule</span>
<span class='co'>####################</span>

<span class='va'>initialLoci</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span><span class='op'>)</span>, <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>endSizes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>initialLoci</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>200</span>

<span class='co'># Can be a function of landscape, id, and/or any other named</span>
<span class='co'>#   variable passed into spread</span>
<span class='va'>stopRule3</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>landscape</span>, <span class='va'>id</span>, <span class='va'>endSizes</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='va'>endSizes</span><span class='op'>[</span><span class='va'>id</span><span class='op'>]</span>

<span class='va'>twoCirclesDiffSize</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, spreadProb <span class='op'>=</span> <span class='fl'>1</span>, loci <span class='op'>=</span> <span class='va'>initialLoci</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span>,
                             directions <span class='op'>=</span> <span class='fl'>8</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule3</span>,
                             endSizes <span class='op'>=</span> <span class='va'>endSizes</span>, stopRuleBehavior <span class='op'>=</span> <span class='st'>"excludePixel"</span><span class='op'>)</span>

<span class='co'># or using named list of named elements:</span>
<span class='va'>twoCirclesDiffSize2</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, spreadProb <span class='op'>=</span> <span class='fl'>1</span>, loci <span class='op'>=</span> <span class='va'>initialLoci</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span>,
                             directions <span class='op'>=</span> <span class='fl'>8</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule3</span>,
                             vars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>endSizes <span class='op'>=</span> <span class='va'>endSizes</span><span class='op'>)</span>, stopRuleBehavior <span class='op'>=</span> <span class='st'>"excludePixel"</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span><span class='op'>(</span><span class='va'>twoCirclesDiffSize</span>, <span class='va'>twoCirclesDiffSize2</span><span class='op'>)</span> <span class='co'>## TRUE</span>
</div><div class='output co'>#&gt; [1] FALSE</div><div class='input'>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>twoCirclesDiffSize</span><span class='op'>)</span>
</div><div class='img'><img src='spread-12.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='va'>cirs</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/getValues.html'>getValues</a></span><span class='op'>(</span><span class='va'>twoCirclesDiffSize</span><span class='op'>)</span>
<span class='va'>vals</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tapply.html'>tapply</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>[</span><span class='va'>twoCirclesDiffSize</span><span class='op'>]</span>, <span class='va'>cirs</span><span class='op'>[</span><span class='va'>cirs</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span>, <span class='va'>sum</span><span class='op'>)</span>

<span class='co'># Stop if sum of landscape is big or mean of quality is too small</span>
<span class='va'>quality</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/raster/man/raster.html'>raster</a></span><span class='op'>(</span><span class='va'>hab</span><span class='op'>)</span>
<span class='va'>quality</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Uniform.html'>runif</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/ncell.html'>ncell</a></span><span class='op'>(</span><span class='va'>quality</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>
<span class='va'>stopRule4</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>landscape</span>, <span class='va'>quality</span>, <span class='va'>cells</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>landscape</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>|</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>quality</span><span class='op'>[</span><span class='va'>cells</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>&lt;</span> <span class='fl'>0.3</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='va'>twoCirclesDiffSize</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, spreadProb <span class='op'>=</span> <span class='fl'>1</span>, loci <span class='op'>=</span> <span class='va'>initialLoci</span>, circle <span class='op'>=</span> <span class='cn'>TRUE</span>,
                             directions <span class='op'>=</span> <span class='fl'>8</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, stopRule <span class='op'>=</span> <span class='va'>stopRule4</span>,
                             quality <span class='op'>=</span> <span class='va'>quality</span>, stopRuleBehavior <span class='op'>=</span> <span class='st'>"excludePixel"</span><span class='op'>)</span>

<span class='co'>##############</span>
<span class='co'># allowOverlap</span>
<span class='co'>##############</span>
<span class='co'>## TODO: fix error when allowOverlap = TRUE</span>
<span class='co'># set.seed(3113)</span>
<span class='co'># initialLoci &lt;- as.integer(sample(1:ncell(hab), 10))</span>
<span class='co'>#</span>
<span class='co'># # using "landscape", "id", and a variable passed in</span>
<span class='co'># maxVal &lt;- rep(500, length(initialLoci))</span>
<span class='co'>#</span>
<span class='co'># # define stopRule</span>
<span class='co'># stopRule2 &lt;- function(landscape, id, maxVal) sum(landscape) &gt; maxVal[id]</span>
<span class='co'># circs &lt;- spread(hab, spreadProb = 1, circle = TRUE, loci = initialLoci, stopRule = stopRule2,</span>
<span class='co'>#                 id = TRUE, allowOverlap = TRUE, stopRuleBehavior = "includeRing",</span>
<span class='co'>#                 maxVal = maxVal, returnIndices = TRUE)</span>
<span class='co'># (vals &lt;- tapply(hab[circs$indices], circs$id, sum))</span>
<span class='co'># vals &lt;= maxVal ## all TRUE</span>
<span class='co'># overlapEvents &lt;- raster(hab)</span>
<span class='co'># overlapEvents[] &lt;- 0</span>
<span class='co'># toMap &lt;- circs[, sum(id), by = indices]</span>
<span class='co'># overlapEvents[toMap$indices] &lt;- toMap$V1</span>
<span class='co'>#</span>
<span class='co'># clearPlot()</span>
<span class='co'># Plot(overlapEvents)</span>

<span class='co'>## Using alternative algorithm, not probabilistic diffusion</span>
<span class='co'>## Will give exactly correct sizes, yet still with variability</span>
<span class='co'>## within the spreading (i.e., cells with and without successes)</span>
<span class='va'>seed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1e6</span>, <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
<span class='va'>startCells</span> <span class='op'>&lt;-</span> <span class='va'>startCells</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>]</span>
<span class='va'>maxSizes</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Exponential.html'>rexp</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>startCells</span><span class='op'>)</span>, rate <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='fl'>500</span><span class='op'>)</span>
<span class='va'>fires</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab</span>, loci <span class='op'>=</span> <span class='va'>startCells</span>, <span class='fl'>1</span>, persistence <span class='op'>=</span> <span class='fl'>0</span>,
                neighProbs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>0.5</span>, <span class='fl'>0.5</span>, <span class='fl'>0.5</span><span class='op'>)</span> <span class='op'>/</span> <span class='fl'>1.5</span>,
                mask <span class='op'>=</span> <span class='cn'>NULL</span>, maxSize <span class='op'>=</span> <span class='va'>maxSizes</span>, directions <span class='op'>=</span> <span class='fl'>8</span>,
                iterations <span class='op'>=</span> <span class='fl'>1e6</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, plot.it <span class='op'>=</span> <span class='cn'>FALSE</span>, exactSizes <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>;
<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>fires</span><span class='op'>[</span><span class='va'>fires</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>[</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>floor</a></span><span class='op'>(</span><span class='va'>maxSizes</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/dev.html'>dev</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>fires</span>, new <span class='op'>=</span> <span class='cn'>TRUE</span>, cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"red"</span>, <span class='st'>"yellow"</span><span class='op'>)</span>, zero.color <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-13.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/hist.html'>hist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>fires</span><span class='op'>[</span><span class='op'>]</span><span class='op'>[</span><span class='va'>fires</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>, title <span class='op'>=</span> <span class='st'>"fire size distribution"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-14.png' alt='' width='700' height='433' /></div><div class='img'><img src='spread-15.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## Example with relativeSpreadProb ... i.e., a relative probability spreadProb</span>
<span class='co'>##  (shown here because because spreadProb raster is not a probability).</span>
<span class='co'>##  Here, we force the events to grow, choosing always 2 neighbours,</span>
<span class='co'>##  according to the relative probabilities contained on hab layer.</span>
<span class='co'>##</span>
<span class='co'>## Note: `neighProbs = c(0,1)` forces each active pixel to move to 2 new pixels</span>
<span class='co'>## (`prob = 0` for 1 neighbour, `prob = 1` for 2 neighbours)</span>
<span class='co'>##</span>
<span class='co'>## Note: set hab3 to be very distinct probability differences, to detect spread</span>
<span class='co'>##  differences</span>
<span class='va'>hab3</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>hab</span> <span class='op'>&lt;</span> <span class='fl'>20</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>200</span> <span class='op'>+</span> <span class='fl'>1</span>
<span class='va'>seed</span> <span class='op'>&lt;-</span> <span class='fl'>643503</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
<span class='va'>sam</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>hab3</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>, <span class='fl'>1</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
<span class='va'>events1</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab3</span>, spreadProb <span class='op'>=</span> <span class='va'>hab3</span>, loci <span class='op'>=</span> <span class='va'>sam</span>, directions <span class='op'>=</span> <span class='fl'>8</span>,
             neighProbs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, maxSize <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>70</span><span class='op'>)</span>, exactSizes <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='co'># Compare to absolute probability version</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
<span class='va'>events2</span> <span class='op'>&lt;-</span> <span class='fu'>spread</span><span class='op'>(</span><span class='va'>hab3</span>, id <span class='op'>=</span> <span class='cn'>TRUE</span>, loci <span class='op'>=</span> <span class='va'>sam</span>, directions <span class='op'>=</span> <span class='fl'>8</span>,
                 neighProbs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, maxSize <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='fl'>70</span><span class='op'>)</span>, exactSizes <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>

<span class='fu'><a href='http://quickplot.predictiveecology.org//reference/clearPlot.html'>clearPlot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>events1</span>, new <span class='op'>=</span> <span class='cn'>TRUE</span>, cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"red"</span>, <span class='st'>"yellow"</span><span class='op'>)</span>, zero.color <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-16.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='va'>events2</span>, new <span class='op'>=</span> <span class='cn'>TRUE</span>, cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/RandomFields/man/QMath.html'>c</a></span><span class='op'>(</span><span class='st'>"red"</span>, <span class='st'>"yellow"</span><span class='op'>)</span>, zero.color <span class='op'>=</span> <span class='st'>"white"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-17.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='http://quickplot.predictiveecology.org//reference/Plot.html'>Plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/raster/man/hist.html'>hist</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>events1</span><span class='op'>[</span><span class='op'>]</span><span class='op'>[</span><span class='va'>events1</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>, breaks <span class='op'>=</span> <span class='fl'>30</span><span class='op'>)</span>, title <span class='op'>=</span> <span class='st'>"Event size distribution"</span><span class='op'>)</span>
</div><div class='img'><img src='spread-18.png' alt='' width='700' height='433' /></div><div class='img'><img src='spread-19.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># Check that events1 resulted in higher hab3 pixels overall</span>

<span class='co'># Compare outputs -- should be more high value hab pixels spread to in event1</span>
<span class='co'>#  (randomness may prevent this in all cases)</span>
<span class='va'>hab3</span><span class='op'>[</span><span class='va'>events1</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span>
</div><div class='output co'>#&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
#&gt; [39] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</div><div class='input'><span class='va'>hab3</span><span class='op'>[</span><span class='va'>events2</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span>
</div><div class='output co'>#&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
#&gt; [39] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>hab3</span><span class='op'>[</span><span class='va'>events1</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>&gt;=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>hab3</span><span class='op'>[</span><span class='va'>events2</span><span class='op'>[</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span> <span class='co'>## should be usually TRUE</span>
</div><div class='output co'>#&gt; [1] TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


