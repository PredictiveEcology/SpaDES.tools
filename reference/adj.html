<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fast adjacent function, and Just In Time compiled version — adj • SpaDES.tools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fast adjacent function, and Just In Time compiled version — adj"><meta property="og:description" content="Faster function for determining the cells of the 4, 8 or bishop
neighbours of the cells. This is a hybrid function that uses
matrix for small numbers of loci (&amp;lt;1e4) and data.table for larger numbers of loci"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SpaDES.tools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/PredictiveEcology/SpaDES.tools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast <code>adjacent</code> function, and Just In Time compiled version</h1>
    <small class="dont-index">Source: <a href="https://github.com/PredictiveEcology/SpaDES.tools/blob/HEAD/R/neighbourhood.R" class="external-link"><code>R/neighbourhood.R</code></a></small>
    <div class="hidden name"><code>adj.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Faster function for determining the cells of the 4, 8 or bishop
neighbours of the <code>cells</code>. This is a hybrid function that uses
matrix for small numbers of loci (&lt;1e4) and data.table for larger numbers of loci</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adj</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">cells</span>,</span>
<span>  directions <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  sort <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pairs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  target <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numCol <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numCell <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  match.adjacent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cutoff.for.data.table <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  torus <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numNeighs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  returnDT <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p><code>Raster*</code> object for which adjacency will be calculated.</p></dd>


<dt>cells</dt>
<dd><p>vector of cell numbers for which adjacent cells should be found.
Cell numbers start with 1 in the upper-left corner and increase
from left to right and from top to bottom.</p></dd>


<dt>directions</dt>
<dd><p>the number of directions in which cells should be connected:
4 (rook's case), 8 (queen's case), or <code>"bishop"</code> to connect
cells with one-cell diagonal moves.
Or a neighbourhood matrix (see Details).</p></dd>


<dt>sort</dt>
<dd><p>logical. Whether the outputs should be sorted or not, using cell ids
of the <code>from</code> cells (and <code>to</code> cells, if <code>match.adjacent</code>
is <code>TRUE</code>).</p></dd>


<dt>pairs</dt>
<dd><p>logical. If <code>TRUE</code>, a matrix of pairs of adjacent cells is returned.
If <code>FALSE</code>, a vector of cells adjacent to cells is returned</p></dd>


<dt>include</dt>
<dd><p>logical. Should the focal cells be included in the result?</p></dd>


<dt>target</dt>
<dd><p>a vector of cells that can be spread to. This is the inverse of a mask.</p></dd>


<dt>numCol</dt>
<dd><p>numeric indicating number of columns in the raster.
Using this with <code>numCell</code> is a bit faster execution time.</p></dd>


<dt>numCell</dt>
<dd><p>numeric indicating number of cells in the raster.
Using this with <code>numCol</code> is a bit faster execution time.</p></dd>


<dt>match.adjacent</dt>
<dd><p>logical. Should the returned object be the same as
<code><a href="https://rdrr.io/pkg/terra/man/adjacent.html" class="external-link">raster::adjacent</a></code>.
Default <code>FALSE</code>, which is faster.</p></dd>


<dt>cutoff.for.data.table</dt>
<dd><p>numeric. If the number of cells is above this value,
the function uses data.table which is faster with
large numbers of cells. Default is 5000, which appears
to be the turning point where data.table becomes faster.</p></dd>


<dt>torus</dt>
<dd><p>Logical. Should the spread event wrap around to the other side of the raster?
Default is <code>FALSE</code>.</p></dd>


<dt>id</dt>
<dd><p>numeric If not <code>NULL</code> (default), then function will return <code>"id"</code> column.</p></dd>


<dt>numNeighs</dt>
<dd><p>A numeric scalar, indicating how many neighbours to return. Must be
less than or equal to <code>directions</code>; which neighbours are random
with equal probabilities.</p></dd>


<dt>returnDT</dt>
<dd><p>A logical. If TRUE, then the function will return the result
as a <code>data.table</code>, if the internals used <code>data.table</code>,
i.e., if number of cells is greater than <code>cutoff.for.data.table</code>.
User should be warned that this will therefore cause the output
format to change depending <code>cutoff.for.data.table</code>.
This will be faster for situations where <code>cutoff.for.data.table = TRUE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Either a matrix (if more than 1 column, i.e., <code>pairs = TRUE</code>,
and/or <code>id</code> is provided), a vector (if only one column), or a <code>data.table</code></p>


<p>(if <code>cutoff.for.data.table</code> is less than <code>length(cells)</code></p>
<p></p>
<p><em>and</em></p>


<p><code>returnDT</code> is <code>TRUE</code>.
To get a consistent output, say a matrix, it would be wise to test the output
for its class.
The variable output is done to minimize coercion to maintain speed.
The columns will be one or more of <code>id</code>, <code>from</code>, <code>to</code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Between 4x (large number loci) to 200x (small number loci) speed gains over
<code>adjacent</code> in raster package. There is some extra speed gain if
<code>NumCol</code> and <code>NumCells</code> are passed rather than a raster.
Efficiency gains come from:</p><ol><li><p>use <code>data.table</code> internally</p><ul><li><p>no need to remove NAs because wrapped or outside points are
just removed directly with data.table</p></li>
<li><p>use data.table to sort and fast select (though not fastest possible)</p></li>
</ul></li>
<li><p>don't make intermediate objects; just put calculation into return statement</p></li>
</ol><p>The steps used in the algorithm are:</p><ol><li><p>Calculate indices of neighbouring cells</p></li>
<li><p>Remove "to" cells that are</p><ul><li><p>&lt;1 or &gt;numCells (i.e., they are above or below raster), using a single modulo
calculation</p></li>
<li><p>where the modulo of "to" cells is equal to 1 if "from" cells are 0 (wrapped right
to left)</p></li>
<li><p>or where the modulo of the "to" cells is equal to 0 if "from" cells are 1 (wrapped
left to right)</p></li>
</ul></li>
</ol></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/terra/man/adjacent.html" class="external-link">raster::adjacent()</a></code></p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Eliot McIntire</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: sp</span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span>, res <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, <span class="fl">1e4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">numCol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">numCell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adj.new</span> <span class="op">&lt;-</span> <span class="fu">adj</span><span class="op">(</span>numCol <span class="op">=</span> <span class="va">numCol</span>, numCell <span class="op">=</span> <span class="va">numCell</span>, cells <span class="op">=</span> <span class="va">sam</span>, directions <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">adj.new</span> <span class="op">&lt;-</span> <span class="fu">adj</span><span class="op">(</span>numCol <span class="op">=</span> <span class="va">numCol</span>, numCell <span class="op">=</span> <span class="va">numCell</span>, cells <span class="op">=</span> <span class="va">sam</span>, directions <span class="op">=</span> <span class="fl">8</span>,</span></span>
<span class="r-in"><span>               include <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Alex M Chubaty, Eliot J B McIntire.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

